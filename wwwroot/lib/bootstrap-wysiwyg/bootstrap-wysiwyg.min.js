(function(n){function t(t){if(typeof t.data=="string"){var r=t.handler,i=t.data.toLowerCase().split(" "),u=["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color"];t.handler=function(t){var s,c;if(this===t.target||!(/textarea|select/i.test(t.target.nodeName)||n.inArray(t.target.type,u)>-1)){var e=t.type!=="keypress"&&n.hotkeys.specialKeys[t.which],h=String.fromCharCode(t.which).toLowerCase(),f="",o={};for(t.altKey&&e!=="alt"&&(f+="alt+"),t.ctrlKey&&e!=="ctrl"&&(f+="ctrl+"),t.metaKey&&!t.ctrlKey&&e!=="meta"&&(f+="meta+"),t.shiftKey&&e!=="shift"&&(f+="shift+"),e?o[f+e]=!0:(o[f+h]=!0,o[f+n.hotkeys.shiftNums[h]]=!0,f==="shift+"&&(o[n.hotkeys.shiftNums[h]]=!0)),s=0,c=i.length;s<c;s++)if(o[i[s]])return r.apply(this,arguments)}}}}n.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};n.each(["keydown","keyup","keypress"],function(){n.event.special[this]={add:t}})})(jQuery),function(n){"use strict";var t=function(t,i){var r=t.find(".wysiwyg-fonts");n.each(["Serif","Sans","Arial","Arial Black","Courier","Courier New","Helvetica","Impact","Lucida Grande","Lucida Sans","Tahoma","Times","Times New Roman","Verdana"],function(t,i){r.append(n('<li><a data-edit="fontName '+i+'" style="font-family:\''+i+"'\">"+i+"<\/a><\/li>"))});t.find(".dropdown-menu").click(function(n){n.stopPropagation()});t.find(".dropdown-menu input[data-"+i.commandRole+"]").click(function(){return!1}).change(function(){n(this).parent(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")}).keydown("esc",function(){this.value="";n(this).change()});t.find("[data-role=magic-overlay]").each(function(){var t=n(this),i=n(this).prev();i.click(function(){t.click()})})},i=function(n,i,r){var u='<div class="btn-toolbar" data-role="editor-toolbar"> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="'+bootstrapWysiwyg.local.font+'"><i class="glyphicon glyphicon-font"><\/i><b class="caret"><\/b><\/a> \t\t\t\t<ul class="dropdown-menu wysiwyg-fonts"> \t\t\t\t<\/ul> \t\t\t\t<\/div>',f;return r.showFontSize&&(u+='<div class="btn-group"> \t\t\t\t<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="'+bootstrapWysiwyg.local.fontSize+'"><i class="glyphicon glyphicon-text-height"><\/i>&nbsp;<b class="caret"><\/b><\/a> \t\t\t\t<ul class="dropdown-menu"> \t\t\t\t\t<li><a data-edit="fontSize 5"><font size="5">'+bootstrapWysiwyg.local.fontSizeHuge+'<\/font><\/a><\/li> \t\t\t\t\t<li><a data-edit="fontSize 3"><font size="3">'+bootstrapWysiwyg.local.fontSizeNormal+'<\/font><\/a><\/li> \t\t\t\t\t<li><a data-edit="fontSize 1"><font size="1">'+bootstrapWysiwyg.local.fontSizeSmall+"<\/font><\/a><\/li> \t\t\t\t<\/ul> \t\t\t<\/div>"),u+='<div class="btn-group"> \t\t\t\t<a class="btn btn-default" data-edit="formatBlock <h4>" title="'+bootstrapWysiwyg.local.header+'"><i class="glyphicon glyphicon-header"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="formatBlock <h5>" title="'+bootstrapWysiwyg.local.subHeader+'"><i class="glyphicon glyphicon-header gn-richTextEditorSubHeader"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default" data-edit="bold" title="'+bootstrapWysiwyg.local.bold+'"><i class="glyphicon glyphicon-bold"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="italic" title="'+bootstrapWysiwyg.local.italic+'"><i class="glyphicon glyphicon-italic"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="strikethrough" title="'+bootstrapWysiwyg.local.strikeThrough+'"><i class="glyphicon glyphicon-font" style="text-decoration: line-through"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="underline" title="'+bootstrapWysiwyg.local.underline+'"><i class="glyphicon glyphicon-font" style="text-decoration: underline"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default" data-edit="insertunorderedlist" title="'+bootstrapWysiwyg.local.bulletList+'"><i class="glyphicon glyphicon-list"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="insertorderedlist" title="'+bootstrapWysiwyg.local.numberList+'"><i class="glyphicon glyphicon-th-list"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="outdent" title="'+bootstrapWysiwyg.local.reduceIndent+'"><i class="glyphicon glyphicon-indent-right"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="indent" title="'+bootstrapWysiwyg.local.indent+'"><i class="glyphicon glyphicon-indent-left"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default" data-edit="justifyleft" title="'+bootstrapWysiwyg.local.alignLeft+'"><i class="glyphicon glyphicon-align-left"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="justifycenter" title="'+bootstrapWysiwyg.local.alignCenter+'"><i class="glyphicon glyphicon-align-center"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="justifyright" title="'+bootstrapWysiwyg.local.alignRight+'"><i class="glyphicon glyphicon-align-right"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="justifyfull" title="'+bootstrapWysiwyg.local.justifyFull+'"><i class="glyphicon glyphicon-align-justify"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="'+bootstrapWysiwyg.local.hyperlink+'"><i class="glyphicon glyphicon-link"><\/i><\/a> \t\t\t\t<div class="dropdown-menu input-append" style="padding: 10px"> \t\t\t\t\t<input class="form-control" placeholder="'+bootstrapWysiwyg.local.url+'" type="text" data-edit="createLink"/> \t\t\t\t\t<button class="btn btn-default" style="margin-top: 5px" type="button">'+bootstrapWysiwyg.local.hyperlinkAdd+'<\/button> \t\t\t\t<\/div> \t\t\t\t<a class="btn btn-default" data-edit="unlink" title="'+bootstrapWysiwyg.local.removeHyperlink+'"><i class="glyphicon glyphicon-link" style="text-decoration: line-through"><\/i><\/a> \t\t\t<\/div> \t\t\t\t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default" title="'+bootstrapWysiwyg.local.insertPicture+'"><i class="glyphicon glyphicon-picture"><\/i><\/a> \t\t\t\t<input type="file" data-role="magic-overlay" data-edit="insertImage" class="wysiwgEditor-imageUpload" /> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="'+bootstrapWysiwyg.local.table+'"><i class="glyphicon glyphicon-th"><\/i><\/a> \t\t\t\t<div class="dropdown-menu input-append" style="padding: 10px"> \t\t\t\t\t<input class="form-control gn-table-columns" placeholder="'+bootstrapWysiwyg.local.columns+'" type="text"/> \t\t\t\t\t<input class="form-control gn-table-rows" placeholder="'+bootstrapWysiwyg.local.rows+'" type="text"/> \t\t\t\t\t<div class="checkbox"><label><input type="checkbox" class="gn-table-addHeader">'+bootstrapWysiwyg.local.addHeaderRow+'<\/label><\/div> \t\t\t\t\t<button class="btn btn-default gn-table-add" style="margin-top: 5px" type="button">'+bootstrapWysiwyg.local.tableAdd+'<\/button> \t\t\t\t<\/div> \t\t\t\t<a class="btn btn-default gn-table-add-row-after" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableAddRowAfter+'" data-editactiveinside="tr"><i class="glyphicon glyphicon-object-align-vertical wysiwgEditor-flipIcon"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-add-row-before" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableAddRowBefore+'" data-editactiveinside="tr"><i class="glyphicon glyphicon-object-align-vertical"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-remove-row" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableRemoveRow+'" data-editactiveinside="tr"><i class="glyphicon glyphicon-object-align-vertical"><\/i><i class="glyphicon glyphicon-remove wysiwgEditor-removeIcon"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-add-column-after" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableAddColumnAfter+'" data-editactiveinside="th,td"><i class="glyphicon glyphicon-object-align-horizontal"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-add-column-before" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableAddColumnBefore+'" data-editactiveinside="th,td"><i class="glyphicon glyphicon-object-align-horizontal wysiwgEditor-flipIcon"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-remove-column" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableRemoveColumn+'" data-editactiveinside="th,td"><i class="glyphicon glyphicon-object-align-horizontal"><\/i><i class="glyphicon glyphicon-remove wysiwgEditor-removeIcon"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-add-header-row" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableAddHeaderRow+'" data-editactiveinside="table"><i class="glyphicon glyphicon-th-large"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default" data-edit="undo" title="'+bootstrapWysiwyg.local.undo+'"><i class="glyphicon glyphicon-share-alt" style="-webkit-transform: scaleX(-1); filter: FlipH;"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="redo" title="'+bootstrapWysiwyg.local.redo+'"><i class="glyphicon glyphicon-share-alt"><\/i><\/a> \t\t\t<\/div>',i&&jQuery.each(i,function(n,t){var i='<div class="btn-group"> \t\t\t\t\t\t\t\t\t<a class="btn btn-default" title="'+t.title+'" data-customcallback="'+n+'"><i class="glyphicon '+t.icon+'"><\/i><\/a> \t\t\t\t\t\t\t\t  <\/div>';u+=i}),u+="<\/div>",f=jQuery(u).insertBefore(n),t(f,r),f},r=function(t){var i=n.Deferred(),r=new FileReader;return r.onload=function(n){i.resolve(n.target.result)},r.onerror=i.reject,r.onprogress=i.notify,r.readAsDataURL(t),i.promise()};n.fn.cleanHtml=function(){var t=n(this).html();return t&&t.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")};n.fn.wysiwyg=function(t){u=n.extend({},n.fn.wysiwyg.defaults,t);var c=i(this,t.additionalButtons,u),y=n(this).html(),f=this,l,u,a,p,h=function(t){var r,i,u;for(window.getSelection?(r=window.getSelection(),r.rangeCount>0&&(i=r.getRangeAt(0).commonAncestorContainer)):(r=document.selection)&&r.type!="Control"&&(i=r.createRange().parentElement()),u=1;i;){if(i.nodeType==u&&n(i).is(t))return i;i=i.parentNode}return null},v=function(){u.activeToolbarClass&&(n(c).find(a).each(function(){var t=n(this).data(u.commandRole);document.queryCommandState(t)?n(this).addClass(u.activeToolbarClass):n(this).removeClass(u.activeToolbarClass)}),n(c).find(p).each(function(){var t=n(this).data(u.activeRole);h(t)!=null?(n(this).removeAttr("disabled"),n(this).attr("title",n(this).data("enabletitle"))):(n(this).attr("disabled","disabled"),n(this).attr("title",n(this).data("disabletitle")))}));var i=n(f).html();y!==i&&(y=i,t&&t.events&&t.events.change&&t.events.change(i))},o=function(n,t){var i=n.split(" "),r=i.shift(),u=i.join(" ")+(t||"");document.execCommand(r,0,u);v()},d=function(t){n.each(t,function(n,t){f.keydown(n,function(n){f.attr("contenteditable")&&f.is(":visible")&&(n.preventDefault(),n.stopPropagation(),o(t))}).keyup(n,function(n){f.attr("contenteditable")&&f.is(":visible")&&(n.preventDefault(),n.stopPropagation())})})},w=function(){var n=window.getSelection();if(n.getRangeAt&&n.rangeCount)return n.getRangeAt(0)},s=function(){l=w()},e=function(){var n=window.getSelection();if(l){try{n.removeAllRanges()}catch(t){document.body.createTextRange().select();document.selection.empty()}n.addRange(l)}},b=function(t,i){if(i.imageUploadUrl){if(t.length!=1){u.fileUploadError(bootstrapWysiwyg.local.onlyOneFileCanBeUploaded);return}if(!/^image\//.test(t[0].type)){u.fileUploadError(bootstrapWysiwyg.local.unsupportedFileType);return}var h=i.imageUploadUrl.replace(/{filename}/g,encodeURIComponent(t[0].name)),s=new FormData;n.each(t,function(n,t){s.append(n,t)});n.ajax({url:h,type:"POST",data:s,cache:!1,headers:GoNorth.Util.generateAntiForgeryHeader(),processData:!1,contentType:!1}).done(function(n){var t=i.fileUploadSuccess(n);e();f.focus();o("insertimage",t);i.afterFileInserted&&i.afterFileInserted()}).fail(function(n,t){u.fileUploadError(t,n)})}else n.each(t,function(t,i){/^image\//.test(i.type)?n.when(r(i)).done(function(n){e();f.focus();o("insertimage",n)}).fail(function(){u.fileUploadError(bootstrapWysiwyg.local.couldNotReadFile)}):u.fileUploadError(bootstrapWysiwyg.local.unsupportedFileType)})},k=function(n,t){e();document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,t||"transparent");s();n.data(u.selectionMarker,t)},g=function(i,r){var c,u,l,v;i.find(a).click(function(){e();f.focus();o(n(this).data(r.commandRole));s()});i.find("[data-toggle=dropdown]").click(e);i.find("input[type=text][data-"+r.commandRole+"]").on("change",function(){var t=this.value;this.value="";e();t&&(f.focus(),o(n(this).data(r.commandRole),t));s()}).on("focus",function(){var t=n(this);t.data(r.selectionMarker)||(k(t,r.selectionColor),t.focus())}).on("blur",function(){var t=n(this);t.data(r.selectionMarker)&&k(t,!1)});i.find("input[type=file][data-"+r.commandRole+"]").change(function(){e();this.type==="file"&&this.files&&this.files.length>0&&b(this.files,t);s();this.value=""});c=function(n,t){for(var u=n.find("tr").first().find("td,th").length,i="<tr>",r=0;r<u;++r)i+="<"+t+"><br/><\/"+t+">";return i+"<\/tr>"};i.find(".gn-table-columns,.gn-table-rows").keydown(function(n){GoNorth.Util.validateNumberKeyPress(jQuery(this),n)});i.find(".gn-table-add").click(function(){var u=parseInt(i.find(".gn-table-columns").val()),h,l,t,c,r;if(isNaN(u)&&(u=1),h=parseInt(i.find(".gn-table-rows").val()),isNaN(h)&&(h=1),l=i.find(".gn-table-addHeader").is(":checked"),t="<div class='table-responsive'><table class='table table-bordered table-striped'>",l){for(t+="<thead><tr>",r=0;r<u;++r)t+="<th><\/th>";t+="<\/tr><\/thead>"}for(t+="<tbody>",c=0;c<h;++c){for(t+="<tr>",r=0;r<u;++r)t+="<td><\/td>";t+="<\/tr>"}t+="<\/tbody><\/table><\/div>";e();f.focus();o("insertHtml",t);s();n(this).parent(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")});u=function(n,t){e();f.focus();var r=window.getSelection(),i=document.createRange();i.setStartBefore(n.first()[0]);i.setEndAfter(n.last()[0]);r.removeAllRanges();r.addRange(i);o("insertHTML",t);s()};l=function(t){var f=n(h("tr")),o=f.closest("table"),i=o.clone(),s=f.index()+1,r=i.find(f.parent().prop("tagName")).children(":nth-child("+s+")"),e;if(r.parent().is("thead")){if(!t)return;r=i.find("tbody>tr").first();t=!1}e=c(i,"td");t?n(e).insertAfter(r):n(e).insertBefore(r);u(o,i[0].outerHTML)};i.find(".gn-table-add-row-after").click(function(){l(!0)});i.find(".gn-table-add-row-before").click(function(){l(!1)});i.find(".gn-table-remove-row").click(function(){var t=n(h("tr")),e=t.index()+1,r=t.closest("table"),i=r.clone(),f;i.find("tr").first().find("td,th").length>1&&(f=i.find(t.parent().prop("tagName")).children(":nth-child("+e+")"),f.remove());u(r,i[0].outerHTML)});v=function(t){var i=n(h("th,td")),r=i.index()+1,f=i.closest("table"),e=f.clone();e.find("tr").each(function(){var i="<td><br/><\/td>";n(this).parent().is("thead")&&(i="<th><br/><\/th>");t?n(i).insertAfter(n(this).find(":nth-child("+r+")")):n(i).insertBefore(n(this).find(":nth-child("+r+")"))});u(f,e[0].outerHTML)};i.find(".gn-table-add-column-after").click(function(){v(!0)});i.find(".gn-table-add-column-before").click(function(){v(!1)});i.find(".gn-table-remove-column").click(function(){var i=n(h("th,td")),f=i.index()+1,r=i.closest("table"),t=r.clone();t.find("tr").first().find("td,th").length>1&&t.find("tr").find(":nth-child("+f+")").remove();u(r,t[0].outerHTML)});i.find(".gn-table-add-header-row").click(function(){var i=n(h("table")),t=i.clone(),r=t.find("thead");r.find("tr").length>0||(r.length==0&&t.prepend("<thead><\/thead>"),t.find("thead").append(c(t,"th")),u(i,t[0].outerHTML))})},nt=function(){f.on("dragenter dragover",!1).on("drop",function(n){var i=n.originalEvent.dataTransfer;n.stopPropagation();n.preventDefault();i&&i.files&&i.files.length>0&&b(i.files,t)})};a="a[data-"+u.commandRole+"],button[data-"+u.commandRole+"],input[type=button][data-"+u.commandRole+"]";p="a[data-"+u.activeRole+"],button[data-"+u.activeRole+"],input[type=button][data-"+u.activeRole+"]";d(u.hotKeys);u.dragAndDropImages&&nt();g(n(u.toolbarSelector),u);t.additionalButtons&&jQuery(c).find("a[data-customcallback]").click(function(){var n=t.additionalButtons[jQuery(this).data("customcallback")];n&&n.callback&&n.callback(function(n){e();n&&(f.focus(),o("insertHTML",n))})});f.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){s();v()});return n(window).bind("touchend",function(n){var i=f.is(n.target)||f.has(n.target).length>0,t=w(),r=t&&t.startContainer===t.endContainer&&t.startOffset===t.endOffset;(!r||i)&&(s(),v())}),this};n.fn.wysiwyg.defaults={hotKeys:{"ctrl+h meta+h":"formatBlock <h4>","ctrl+g meta+g":"formatBlock <h5>","ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeRole:"editactiveinside",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,showFontSize:!1,fileUploadError:function(){}}}(window.jQuery);