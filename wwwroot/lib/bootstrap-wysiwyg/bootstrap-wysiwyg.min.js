(function(n){function t(t){if(typeof t.data=="string"){var r=t.handler,i=t.data.toLowerCase().split(" "),u=["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color"];t.handler=function(t){var s,c;if(this===t.target||!(/textarea|select/i.test(t.target.nodeName)||n.inArray(t.target.type,u)>-1)){var e=t.type!=="keypress"&&n.hotkeys.specialKeys[t.which],h=String.fromCharCode(t.which).toLowerCase(),f="",o={};for(t.altKey&&e!=="alt"&&(f+="alt+"),t.ctrlKey&&e!=="ctrl"&&(f+="ctrl+"),t.metaKey&&!t.ctrlKey&&e!=="meta"&&(f+="meta+"),t.shiftKey&&e!=="shift"&&(f+="shift+"),e?o[f+e]=!0:(o[f+h]=!0,o[f+n.hotkeys.shiftNums[h]]=!0,f==="shift+"&&(o[n.hotkeys.shiftNums[h]]=!0)),s=0,c=i.length;s<c;s++)if(o[i[s]])return r.apply(this,arguments)}}}}n.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};n.each(["keydown","keyup","keypress"],function(){n.event.special[this]={add:t}})})(jQuery),function(n){var e=function(t){function i(t,r=0){function f(){for(var n="",t=0;t<r;++t)n+="\t";return n}var r,t=n.parseHTML(t),u="",e=!1;return n.each(t,function(t,o){var c,s,h;o.nodeName=="#text"?(n(o).text().trim().length&&(u+=f()+n(o).text().trim()),e=!0):(c=n(o).html().trim(),n(o).html(c.replace("\n","").replace(/ +(?= )/g,"")),n(o).children().length?(n(o).html("\n"+i(c,r+1)+f()),h=n(o).prop("outerHTML").trim(),s="",e||(s=f()),u+=s+h+"\n"):(s="",e||(s=f()),h=n(o).prop("outerHTML").trim(),u+=s+h+"\n"),e=!1)}),u}return i(t.replace(/(\r\n|\n|\r)/gm," ").replace(/ +(?= )/g,""))};"use strict";var o=function(t,i){var r=t.find(".wysiwyg-fonts");n.each(["Serif","Sans","Arial","Arial Black","Courier","Courier New","Helvetica","Impact","Lucida Grande","Lucida Sans","Tahoma","Times","Times New Roman","Verdana"],function(t,i){r.append(n('<li><a data-edit="fontName '+i+'" style="font-family:\''+i+"'\">"+i+"<\/a><\/li>"))});t.find(".dropdown-menu").click(function(n){n.stopPropagation()});t.find(".dropdown-menu input[data-"+i.commandRole+"]").click(function(){return!1}).change(function(){n(this).parent(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")}).keydown("esc",function(){this.value="";n(this).change()});t.find("[data-role=magic-overlay]").each(function(){var t=n(this),i=n(this).prev();i.click(function(){t.click()})})},t=function(n,i){for(var u,r=0;r<n.childNodes.length;++r)u=n.childNodes[r],t(u,i),i(u)},i=function(n,t){var f=!1,r=[],u,i;if(!n||!t)return!1;if(n.nodeName==t.nodeName)for(r.push([n,t]);!f;){if(n=n.childNodes[n.childNodes.length-1],t=t.childNodes[0],!n||!t)break;n.nodeName!=t.nodeName?f=!0:r.push([n,t])}for(u=r.length-1;u>=0;--u){for(i=r[u];i[1].childNodes.length>0;)i[0].appendChild(i[1].childNodes[0]);i[1].parentNode.removeChild(i[1])}},s=function(n,r){for(var e,h,c,l,f=n.extractContents(),o=f.childNodes,s=[],u=0;u<o.length;++u)o[u].nodeName.toLowerCase()=="#text"?s.push(o[u]):t(o[u],function(n){n.nodeName.toLowerCase()=="#text"&&s.push(n)});for(u=0;u<s.length;++u)e=s[u],h=typeof r=="function"?r():jQuery(r)[0],e.nodeValue.replace(/(\s|\n|\t)/g,"").length!=0?(e.parentNode.insertBefore(h,e),h.appendChild(e)):h=null;c=f.childNodes[0];l=f.childNodes[f.childNodes.length-1];n.insertNode(f);i(c.previousSibling,c);i(l,l.nextSibling);f=null},r=function(n,t){for(var r=[],u,i;t[0]!=n[0];){if(r.length>100)break;for(u=jQuery(t).parent().contents(),i=0;i<u.length;++i)u[i]==t[0]&&r.push(i);t=jQuery(t).parent()}return r.reverse(),r},u=function(n,t){for(var i=jQuery(n),r=0;r<t.length;++r)i=i.contents().eq(t[r]);return i},h=function(n,t){var o=getSelection();if(o.rangeCount!=0){var f=o.getRangeAt(0),h=r(n,jQuery(f.startContainer)),c=r(n,jQuery(f.endContainer)),i=jQuery("<div>"+jQuery(n).html()+"<\/div>"),l=u(i[0],h),a=u(i[0],c);let e=document.createRange();for(e.setStart(l[0],f.startOffset),e.setEnd(a[0],f.endOffset),s(e,t);i.children().length==1&&i.children().first().is("div");)i.children().children().unwrap();return i.html()}},f=function(n,t,i){var r=t;return i&&(r=i+"."+t),'<a class="btn btn-default" title="'+n.title+'" data-customcallback="'+r+'"><i class="glyphicon '+n.icon+'"><\/i><\/a>'},c=function(n,t,i){var r='<div class="btn-toolbar" data-role="editor-toolbar"> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="'+bootstrapWysiwyg.local.font+'"><i class="glyphicon glyphicon-font"><\/i><b class="caret"><\/b><\/a> \t\t\t\t<ul class="dropdown-menu wysiwyg-fonts"> \t\t\t\t<\/ul> \t\t\t\t<\/div>',u;return i.showFontSize&&(r+='<div class="btn-group"> \t\t\t\t<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="'+bootstrapWysiwyg.local.fontSize+'"><i class="glyphicon glyphicon-text-height"><\/i>&nbsp;<b class="caret"><\/b><\/a> \t\t\t\t<ul class="dropdown-menu"> \t\t\t\t\t<li><a data-edit="fontSize 5"><font size="5">'+bootstrapWysiwyg.local.fontSizeHuge+'<\/font><\/a><\/li> \t\t\t\t\t<li><a data-edit="fontSize 3"><font size="3">'+bootstrapWysiwyg.local.fontSizeNormal+'<\/font><\/a><\/li> \t\t\t\t\t<li><a data-edit="fontSize 1"><font size="1">'+bootstrapWysiwyg.local.fontSizeSmall+"<\/font><\/a><\/li> \t\t\t\t<\/ul> \t\t\t<\/div>"),r+='<div class="btn-group"> \t\t\t\t<a class="btn btn-default" data-edit="formatBlock <h4>" title="'+bootstrapWysiwyg.local.header+'"><i class="glyphicon glyphicon-header"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="formatBlock <h5>" title="'+bootstrapWysiwyg.local.subHeader+'"><i class="glyphicon glyphicon-header gn-richTextEditorSubHeader"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default" data-edit="bold" title="'+bootstrapWysiwyg.local.bold+'"><i class="glyphicon glyphicon-bold"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="italic" title="'+bootstrapWysiwyg.local.italic+'"><i class="glyphicon glyphicon-italic"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="strikethrough" title="'+bootstrapWysiwyg.local.strikeThrough+'"><i class="glyphicon glyphicon-font" style="text-decoration: line-through"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="underline" title="'+bootstrapWysiwyg.local.underline+'"><i class="glyphicon glyphicon-font" style="text-decoration: underline"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default" data-edit="insertunorderedlist" title="'+bootstrapWysiwyg.local.bulletList+'"><i class="glyphicon glyphicon-list"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="insertorderedlist" title="'+bootstrapWysiwyg.local.numberList+'"><i class="glyphicon glyphicon-th-list"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="outdent" title="'+bootstrapWysiwyg.local.reduceIndent+'"><i class="glyphicon glyphicon-indent-right"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="indent" title="'+bootstrapWysiwyg.local.indent+'"><i class="glyphicon glyphicon-indent-left"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default" data-edit="justifyleft" title="'+bootstrapWysiwyg.local.alignLeft+'"><i class="glyphicon glyphicon-align-left"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="justifycenter" title="'+bootstrapWysiwyg.local.alignCenter+'"><i class="glyphicon glyphicon-align-center"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="justifyright" title="'+bootstrapWysiwyg.local.alignRight+'"><i class="glyphicon glyphicon-align-right"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="justifyfull" title="'+bootstrapWysiwyg.local.justifyFull+'"><i class="glyphicon glyphicon-align-justify"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="'+bootstrapWysiwyg.local.hyperlink+'"><i class="glyphicon glyphicon-link"><\/i><\/a> \t\t\t\t<div class="dropdown-menu input-append" style="padding: 10px"> \t\t\t\t\t<input class="form-control" placeholder="'+bootstrapWysiwyg.local.url+'" type="text" data-edit="createLink"/> \t\t\t\t\t<button class="btn btn-default" style="margin-top: 5px" type="button">'+bootstrapWysiwyg.local.hyperlinkAdd+'<\/button> \t\t\t\t<\/div> \t\t\t\t<a class="btn btn-default" data-edit="unlink" title="'+bootstrapWysiwyg.local.removeHyperlink+'"><i class="glyphicon glyphicon-link" style="text-decoration: line-through"><\/i><\/a> \t\t\t<\/div> \t\t\t\t\t\t<div class="btn-group gn-insertRichtextImage"> \t\t\t\t<a class="btn btn-default" title="'+bootstrapWysiwyg.local.insertPicture+'"><i class="glyphicon glyphicon-picture"><\/i><\/a> \t\t\t\t<input type="file" data-role="magic-overlay" data-edit="insertImage" class="wysiwgEditor-imageUpload" /> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="'+bootstrapWysiwyg.local.table+'"><i class="glyphicon glyphicon-th"><\/i><\/a> \t\t\t\t<div class="dropdown-menu input-append" style="padding: 10px"> \t\t\t\t\t<input class="form-control gn-table-columns" placeholder="'+bootstrapWysiwyg.local.columns+'" type="text"/> \t\t\t\t\t<input class="form-control gn-table-rows" placeholder="'+bootstrapWysiwyg.local.rows+'" type="text"/> \t\t\t\t\t<div class="checkbox"><label><input type="checkbox" class="gn-table-addHeader">'+bootstrapWysiwyg.local.addHeaderRow+'<\/label><\/div> \t\t\t\t\t<button class="btn btn-default gn-table-add" style="margin-top: 5px" type="button">'+bootstrapWysiwyg.local.tableAdd+'<\/button> \t\t\t\t<\/div> \t\t\t\t<a class="btn btn-default gn-table-add-row-after" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableAddRowAfter+'" data-editactiveinside="tr"><i class="glyphicon glyphicon-object-align-vertical wysiwgEditor-flipIcon"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-add-row-before" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableAddRowBefore+'" data-editactiveinside="tr"><i class="glyphicon glyphicon-object-align-vertical"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-remove-row" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableRemoveRow+'" data-editactiveinside="tr"><i class="glyphicon glyphicon-object-align-vertical"><\/i><i class="glyphicon glyphicon-remove wysiwgEditor-removeIcon"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-add-column-after" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableAddColumnAfter+'" data-editactiveinside="th,td"><i class="glyphicon glyphicon-object-align-horizontal"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-add-column-before" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableAddColumnBefore+'" data-editactiveinside="th,td"><i class="glyphicon glyphicon-object-align-horizontal wysiwgEditor-flipIcon"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-remove-column" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableRemoveColumn+'" data-editactiveinside="th,td"><i class="glyphicon glyphicon-object-align-horizontal"><\/i><i class="glyphicon glyphicon-remove wysiwgEditor-removeIcon"><\/i><\/a> \t\t\t\t<a class="btn btn-default gn-table-add-header-row" disabled="disabled" title="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-disabletitle="'+bootstrapWysiwyg.local.onlyAvailableInsideTable+'" data-enabletitle="'+bootstrapWysiwyg.local.tableAddHeaderRow+'" data-editactiveinside="table"><i class="glyphicon glyphicon-th-large"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default" data-edit="undo" title="'+bootstrapWysiwyg.local.undo+'"><i class="glyphicon glyphicon-share-alt" style="-webkit-transform: scaleX(-1); filter: FlipH;"><\/i><\/a> \t\t\t\t<a class="btn btn-default" data-edit="redo" title="'+bootstrapWysiwyg.local.redo+'"><i class="glyphicon glyphicon-share-alt"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group"> \t\t\t\t<a class="btn btn-default enterHtmlMode" title="'+bootstrapWysiwyg.local.editHtml+'"><i class="glyphicon glyphicon-console"><\/i><\/a> \t\t\t<\/div> \t\t\t<div class="btn-group htmlModeButton" style="display: none"> \t\t\t\t<a class="btn btn-default leaveHtmlMode" title="'+bootstrapWysiwyg.local.editText+'"><i class="glyphicon glyphicon-text-size"><\/i><\/a> \t\t\t<\/div>',t&&jQuery.each(t,function(n,t){r+='<div class="btn-group">';t.toolbarButtonGroup?jQuery.each(t.toolbarButtonGroup,function(t,i){r+=f(i,t,n)}):r+=f(t,n,"");r+="<\/div>"}),r+="<\/div>",u=jQuery(r).insertBefore(n),o(u,i),u},l=function(t){var i=n.Deferred(),r=new FileReader;return r.onload=function(n){i.resolve(n.target.result)},r.onerror=i.reject,r.onprogress=i.notify,r.readAsDataURL(t),i.promise()};n.fn.cleanHtml=function(){var t=n(this).html();return t&&t.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")};n.fn.wysiwyg=function(t){var a;r=n.extend({},n.fn.wysiwyg.defaults,t);var o=c(this,t.additionalButtons,r),u=jQuery("<textarea style='display: none; width: calc(100% - 10px);resize: none'><\/textarea>"),w="htmlEditor wysiwgEditor";n(this).attr("class")&&(w+=" "+n(this).attr("class"));u.attr("class",w);u.insertAfter(this);a=n(this).html();t.richTextDisableImageUpload&&n(o).find(".gn-insertRichtextImage").hide();var i=this,v,r,y,b,s=function(t){var r,i,u;for(window.getSelection?(r=window.getSelection(),r.rangeCount>0&&(i=r.getRangeAt(0).commonAncestorContainer)):(r=document.selection)&&r.type!="Control"&&(i=r.createRange().parentElement()),u=1;i;){if(i.nodeType==u&&n(i).is(t))return i;i=i.parentNode}return null},k=function(){r.focusChangeCallback&&(window.getSelection?(sel=window.getSelection(),sel.rangeCount>0&&(containerNode=sel.getRangeAt(0).commonAncestorContainer)):(sel=document.selection)&&sel.type!="Control"&&(containerNode=sel.createRange().parentElement()),r.focusChangeCallback(containerNode))},p=function(){r.activeToolbarClass&&(n(o).find(y).each(function(){var t=n(this).data(r.commandRole);document.queryCommandState(t)?n(this).addClass(r.activeToolbarClass):n(this).removeClass(r.activeToolbarClass)}),n(o).find(b).each(function(){var t=n(this).data(r.activeRole);s(t)!=null?(n(this).removeAttr("disabled"),n(this).attr("title",n(this).data("enabletitle"))):(n(this).attr("disabled","disabled"),n(this).attr("title",n(this).data("disabletitle")))}));var u=n(i).html();a!==u&&(a=u,t&&t.events&&t.events.change&&t.events.change(u))},f=function(n,t){var i=n.split(" "),r=i.shift(),u=i.join(" ")+(t||"");document.execCommand(r,0,u);p();k()},nt=function(t){n.each(t,function(n,t){i.keydown(n,function(n){i.attr("contenteditable")&&i.is(":visible")&&(n.preventDefault(),n.stopPropagation(),f(t))}).keyup(n,function(n){i.attr("contenteditable")&&i.is(":visible")&&(n.preventDefault(),n.stopPropagation())})})},d=function(){var n=window.getSelection();if(n.getRangeAt&&n.rangeCount)return n.getRangeAt(0)},g=function(){try{selection.removeAllRanges()}catch(t){if(document.body.createTextRange)document.body.createTextRange().select(),document.selection.empty();else{var n=document.createRange();window.getSelection().addRange(n);window.getSelection().empty()}}};if(saveSelection=function(){v=d()},restoreSelection=function(){var n=window.getSelection(),t;if(v){try{n.removeAllRanges()}catch(i){document.body.createTextRange?(document.body.createTextRange().select(),document.selection.empty()):(t=document.createRange(),window.getSelection().addRange(t),window.getSelection().empty())}n.addRange(v)}},insertFiles=function(t,u){if(!u.richTextDisableImageUpload)if(u.imageUploadUrl){if(t.length!=1){r.fileUploadError(bootstrapWysiwyg.local.onlyOneFileCanBeUploaded);return}if(!/^image\//.test(t[0].type)){r.fileUploadError(bootstrapWysiwyg.local.unsupportedFileType);return}u.fileUploadStarted&&u.fileUploadStarted();var o=u.imageUploadUrl.replace(/{filename}/g,encodeURIComponent(t[0].name)),e=new FormData;n.each(t,function(n,t){e.append(n,t)});n.ajax({url:o,type:"POST",data:e,cache:!1,headers:GoNorth.Util.generateAntiForgeryHeader(),processData:!1,contentType:!1}).done(function(n){var t=u.fileUploadSuccess(n);restoreSelection();i.focus();f("insertimage",t);u.afterFileInserted&&u.afterFileInserted()}).fail(function(n,t){r.fileUploadError(t,n)})}else n.each(t,function(t,u){/^image\//.test(u.type)?n.when(l(u)).done(function(n){restoreSelection();i.focus();f("insertimage",n)}).fail(function(){r.fileUploadError(bootstrapWysiwyg.local.couldNotReadFile)}):r.fileUploadError(bootstrapWysiwyg.local.unsupportedFileType)})},markSelection=function(n,t){restoreSelection();document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,t||"transparent");saveSelection();n.data(r.selectionMarker,t)},bindToolbar=function(r,h){var l,c,a,v;r.find(y).click(function(){restoreSelection();i.focus();f(n(this).data(h.commandRole));saveSelection()});r.find("[data-toggle=dropdown]").click(restoreSelection);r.find("input[type=text][data-"+h.commandRole+"]").on("change",function(){var t=this.value;this.value="";restoreSelection();t&&(i.focus(),f(n(this).data(h.commandRole),t));saveSelection()}).on("focus",function(){var t=n(this);t.data(h.selectionMarker)||(markSelection(t,h.selectionColor),t.focus())}).on("blur",function(){var t=n(this);t.data(h.selectionMarker)&&markSelection(t,!1)});r.find("input[type=file][data-"+h.commandRole+"]").change(function(){restoreSelection();this.type=="file"&&this.files&&this.files.length>0&&insertFiles(this.files,t);saveSelection();this.value=""});r.find(".enterHtmlMode").click(function(){jQuery(i).hide();u.val(e(jQuery(i).html()));u.show();o.children(":not(.htmlModeButton)").hide();o.children(".htmlModeButton").show()});r.find(".leaveHtmlMode").click(function(){u.blur();u.hide();jQuery(i).show();o.children(":not(.htmlModeButton)").show();o.children(".htmlModeButton").hide()});u.blur(function(){var t=u.val(),n=t.replace(/<script[\S\s]*?>[\S\s]*?<\/script>/gmi,"");n!=t&&u.val(n);jQuery(i).html(n);h.events&&h.events.change&&h.events.change(jQuery(i).html())});l=function(n,t){for(var u=n.find("tr").first().find("td,th").length,i="<tr>",r=0;r<u;++r)i+="<"+t+"><br/><\/"+t+">";return i+"<\/tr>"};r.find(".gn-table-columns,.gn-table-rows").keydown(function(n){GoNorth.Util.validateNumberKeyPress(jQuery(this),n)});r.find(".gn-table-add").click(function(){var e=parseInt(r.find(".gn-table-columns").val()),o,h,t,s,u;if(isNaN(e)&&(e=1),o=parseInt(r.find(".gn-table-rows").val()),isNaN(o)&&(o=1),h=r.find(".gn-table-addHeader").is(":checked"),t="<div class='table-responsive'><table class='table table-bordered table-striped'>",h){for(t+="<thead><tr>",u=0;u<e;++u)t+="<th><\/th>";t+="<\/tr><\/thead>"}for(t+="<tbody>",s=0;s<o;++s){for(t+="<tr>",u=0;u<e;++u)t+="<td><\/td>";t+="<\/tr>"}t+="<\/tbody><\/table><\/div>";restoreSelection();i.focus();f("insertHtml",t);saveSelection();n(this).parent(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")});c=function(n,t){restoreSelection();i.focus();var u=window.getSelection(),r=document.createRange();r.setStartBefore(n.first()[0]);r.setEndAfter(n.last()[0]);u.removeAllRanges();u.addRange(r);f("insertHTML",t);saveSelection()};a=function(t){var u=n(s("tr")),e=u.closest("table"),i=e.clone(),o=u.index()+1,r=i.find(u.parent().prop("tagName")).children(":nth-child("+o+")"),f;if(r.parent().is("thead")){if(!t)return;r=i.find("tbody>tr").first();t=!1}f=l(i,"td");t?n(f).insertAfter(r):n(f).insertBefore(r);c(e,i[0].outerHTML)};r.find(".gn-table-add-row-after").click(function(){a(!0)});r.find(".gn-table-add-row-before").click(function(){a(!1)});r.find(".gn-table-remove-row").click(function(){var t=n(s("tr")),f=t.index()+1,r=t.closest("table"),i=r.clone(),u;i.find("tr").first().find("td,th").length>1&&(u=i.find(t.parent().prop("tagName")).children(":nth-child("+f+")"),u.remove());c(r,i[0].outerHTML)});v=function(t){var i=n(s("th,td")),r=i.index()+1,u=i.closest("table"),f=u.clone();f.find("tr").each(function(){var i="<td><br/><\/td>";n(this).parent().is("thead")&&(i="<th><br/><\/th>");t?n(i).insertAfter(n(this).find(":nth-child("+r+")")):n(i).insertBefore(n(this).find(":nth-child("+r+")"))});c(u,f[0].outerHTML)};r.find(".gn-table-add-column-after").click(function(){v(!0)});r.find(".gn-table-add-column-before").click(function(){v(!1)});r.find(".gn-table-remove-column").click(function(){var i=n(s("th,td")),u=i.index()+1,r=i.closest("table"),t=r.clone();t.find("tr").first().find("td,th").length>1&&t.find("tr").find(":nth-child("+u+")").remove();c(r,t[0].outerHTML)});r.find(".gn-table-add-header-row").click(function(){var i=n(s("table")),t,r;i.length!=0&&((t=i.clone(),r=t.find("thead"),r.find("tr").length>0)||(r.length==0&&t.prepend("<thead><\/thead>"),t.find("thead").append(l(t,"th")),c(i,t[0].outerHTML)))})},initFileDrops=function(){i.on("dragenter dragover",!1).on("drop",function(n){var i=n.originalEvent.dataTransfer;n.stopPropagation();n.preventDefault();i&&i.files&&i.files.length>0&&insertFiles(i.files,t)})},y="a[data-"+r.commandRole+"],button[data-"+r.commandRole+"],input[type=button][data-"+r.commandRole+"]",b="a[data-"+r.activeRole+"],button[data-"+r.activeRole+"],input[type=button][data-"+r.activeRole+"]",nt(r.hotKeys),r.dragAndDropImages&&initFileDrops(),bindToolbar(n(r.toolbarSelector),r),t.additionalButtons)jQuery(o).find("a[data-customcallback]").on("click",function(){var n=jQuery(this).data("customcallback").split("."),u=t.additionalButtons,r;n.length>1&&(u=u[n[0]].toolbarButtonGroup);r=u[n[n.length-1]];r&&r.callback&&r.callback(function(n){restoreSelection();n&&(i.focus(),f("insertHTML",n))},function(n){var r,t;restoreSelection();n&&(i.focus(),r=h(i,n),g(),t=document.createRange(),t.selectNodeContents(jQuery(i)[0]),window.getSelection().addRange(t),f("insertHTML",r),g())})});i.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){saveSelection();p()}).on("paste",function(n){n.originalEvent&&n.originalEvent.clipboardData&&n.originalEvent.clipboardData&&n.originalEvent.clipboardData.types&&n.originalEvent.clipboardData.types.indexOf("Files")>=0&&n.preventDefault()}).on("mouseup keyup touchend",function(){k()});return n(window).bind("touchend",function(n){var r=i.is(n.target)||i.has(n.target).length>0,t=d(),u=t&&t.startContainer==t.endContainer&&t.startOffset==t.endOffset;(!u||r)&&(saveSelection(),p())}),this};n.fn.wysiwyg.defaults={hotKeys:{"ctrl+h meta+h":"formatBlock <h4>","ctrl+g meta+g":"formatBlock <h5>","ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeRole:"editactiveinside",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,showFontSize:!1,fileUploadError:function(){}}}(window.jQuery);